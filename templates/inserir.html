{% extends 'base.html' %}
{% block content %}
<div class="content">
  {% if mensagem %}
    <div class="mensagem {{ tipo_mensagem }}">{{ mensagem }}</div>
  {% endif %}

  <form method="POST">
    <label>FORNECEDOR:</label>
    <select name="fornecedor" required>
      <option value="">-- Escolha --</option>
      <option value="DEJAVU">DEJAVU</option>
      <option value="AI COSMETIC">AI COSMETIC</option>
    </select>

    <label>NOME DO PRODUTO:</label>
    <input type="text" name="produto" required />

    <label>QUANTIDADE:</label>
    <input type="number" name="quantidade" min="1" required />

    <label>PREÇO:</label>
    <input type="text" name="preco" id="preco" required oninput="formatarMoeda(this)" />

    <!-- Botão com animação correta -->
    <button type="submit" class="button inserir">
      <span>INSERIR</span>
      <div class="icon">
        <i class="fa fa-plus icon-plus"></i>
        <i class="fa fa-check icon-check" style="display: none;"></i>
      </div>
    </button>
  </form>
</div>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

<script>
  function formatarMoeda(campo) {
    let valor = campo.value.replace(/\D/g, "");
    valor = (valor / 100).toFixed(2) + "";
    valor = valor.replace(".", ",");
    valor = valor.replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.");
    campo.value = "R$ " + valor;
  }

  window.onload = function () {
    const msg = document.querySelector(".mensagem");
    const button = document.querySelector(".button.inserir");
    const iconPlus = document.querySelector(".icon-plus");
    const iconCheck = document.querySelector(".icon-check");

    if (msg) {
      setTimeout(() => {
        msg.style.display = "none";
      }, 3000);
    }

    if (button && msg && msg.classList.contains("sucesso")) {
      button.classList.add("success");

      // Alterna os ícones
      if (iconPlus) iconPlus.style.display = "none";
      if (iconCheck) iconCheck.style.display = "inline-block";

      setTimeout(() => {
        button.classList.remove("success");
        if (iconPlus) iconPlus.style.display = "inline-block";
        if (iconCheck) iconCheck.style.display = "none";
      }, 3000);
    }
  };
</script>
{% endblock %}
